{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <div>
          <h5 class="mb-0">Ingreso</h5>
          <small class="text-muted">Autent√≠cate para continuar</small>
        </div>
        <button id="jwt-btn" type="button" class="btn btn-outline-secondary btn-sm">Obtener JWT</button>
      </div>
      <div class="card-body">
        <form method="post" class="mb-3" novalidate>
          {% csrf_token %}
          <div class="mb-3">
            <label class="form-label">Usuario</label>
            <input name="username" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" name="password" class="form-control" required>
          </div>
          <div class="d-flex justify-content-end">
            <button class="btn btn-primary" type="submit">Ingresar</button>
          </div>
        </form>
        <pre id="jwt-output" class="bg-light border rounded p-2 text-break"></pre>
      </div>
    </div>
  </div>
</div>
<script>
document.getElementById('jwt-btn').addEventListener('click', async () => {
  const username = document.querySelector('input[name="username"]').value;
  const password = document.querySelector('input[name="password"]').value;
  try {
    const res = await fetch('/api/token/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });
    const data = await res.json();
    if (res.ok) {
      localStorage.setItem('access', data.access);
      localStorage.setItem('refresh', data.refresh);
    }
    document.getElementById('jwt-output').textContent = JSON.stringify(data, null, 2);
  } catch (e) {
    document.getElementById('jwt-output').textContent = e.toString();
  }
});
</script>
{% endblock %}
